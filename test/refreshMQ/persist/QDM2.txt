/**
 * Manages quiz data via an EntityManager.  Like EntityManager, this
 * class is not thread-safe; a QuizDataManager instance is meant to be
 * used by a single thread.
 */
public class QuizDataManager {
   private static String PERSISTENCE_UNIT = "quizData";

   // A single global entity manager factory
   private static EntityManagerFactory factory = 
      Persistence.createEntityManagerFactory(PERSISTENCE_UNIT);

   EntityManager entityManager;

   /**
    * Lazily initializes the entity manager when we need it. 
    */
   public EntityManager getEntityManager() {
      if (entityManager == null) 
	 entityManager = factory.createEntityManager();
      return entityManager;
   }

   /**
    * Shuts down the entity manager.
    */
   public void shutdown() {
      if (entityManager != null) {
	 entityManager.close();
	 entityManager = null;
      }
   }

   /**
    * Performs a shutdown on object cleanup, if necessary.
    */
   @Override 
   protected void finalize() {
      shutdown();
   }
}
